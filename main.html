<html>
<head>
    <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
    <style>
        .camControl button{
            height: 30px;
        }
        .camControl .top, .bottom{
            display: block;
            width: 206px;
        }
        .camControl .left, .right{
            width: 101px;
        }
    </style>
</head>
<body>
<!-- <button onclick="run('fire',0)">Fire</button>
<button onclick="run('right',500)">Right</button>
<button onclick="run('left',500)">Left</button>
<button onclick="run('up',500)">Up</button>
<button onclick="run('down',500)">Down</button>
<button onclick="run('park',500)">Park</button> -->
<div class="camControl">
    <img id="cam" src="../ram/cam.jpg"/>
    <button class="top" onclick="send(1,1)">UP</button>
    <button class="left" onclick="send(0,0)">LEFT</button>
    <button class="right" onclick="send(0,1)">RIGHT</button>
    <button class="bottom" onclick="send(1,0)">DOWN</button>
    <span>Cam On</span><input class="camButton" type="checkbox" onclick="toggleCam()">
</div>
<script>
    var intervalId = 0;
    var angleV = 80;
    var angle = 80;

    var run = function(cmd,val) {
        $.get("php/missilecmd.php?cmd=" + cmd + "&val=" + val);
    }

    var makeServoCall = function(a,s){
        $.get("php/servo_cmd.php?angle="+a+"&sno="+s, function(output){
            console.log('servo_cmd output: '+ output);
        });
    };

    var makeCamCall = function(state){
        $.get("php/cam_cmd.php?on="+state, function(output){
            console.log('cam_cmd output: '+ output);
        });
    }

    var send = function(s,p){
        var a = 0;
        if(s === 1){
            if(p==1) {
                a = angleV += 10;
            }else{
                a = angleV -= 10;
            }
        }else{
            if(p==1) {
                a = angle += 10;
            }else{
                a = angle -= 10;
            }
        }

        a = Math.max(s===1?10:0, a);
        a = Math.min(s===1?170:180, a);

        makeServoCall(a,s);
    }

    send(1,1);
    send(0,1);

    var toggleCam = function () {
        var checked = $('.camButton').attr('checked');
        if(checked){
            $('.camButton').attr('checked', false);
            clearInterval(intervalId);
            makeCamCall(0);
        }else{
            $('.camButton').attr('checked', true);
            makeCamCall(1);
            intervalId =  setInterval(function(){
                $("#cam").attr("src","../ram/cam.jpg?"+new Date().getTime());
            },150);
        }
    }
</script>
</body>
</html>
